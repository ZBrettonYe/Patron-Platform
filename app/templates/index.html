<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<title>绅士赞助系统</title>
	<meta name="keywords" content="绅士赞助系统,绅士世界">
	<meta name="description" content="绅士赞助系统,赞助使我们存在">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="https://cdnjs.loli.net/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet"/>
	<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<style>
		.bgt {
			filter: alpha(opacity=20); /*ie透明度20%*/
			-moz-opacity: 0.8; /*Moz + FF 透明度20%*/
			opacity: 0.8;
		}
	</style>
</head>
<body background="http://wx2.sinaimg.cn/large/005uGS7jgy1fvclwhfqjxj31hc0xc7ib.jpg" style="background-size: cover;">
<div class="container">
	<div class="row" style="margin-top: 60px">
		<div class="col-sm-12 col-md-6 mb-3 bgt">
			<div class="card mb-3">
				<div class="card-header" style="background: linear-gradient(to right,#8ae68a,#5ccdde,#b221ff);">
					赞助入口
				</div>
				<div class="alert alert-info mb-0">
					<a href="http://wpa.qq.com/msgrd?v=3&uin={{qq}}&site=qq&menu=yes" style="padding-right: 20px"><img src="https://i.jpg.dog/content/images/system/logo_1530884671755_5d660e.svg" width="60px" alt="->"></a><span class="card-title">感谢大佬对我们的赞助！</span>
				</div>
				<ul class="list-group list-group-flush">
					<li class="list-group-item">
						<div class="input-group">
							<div class="input-group-prepend">
								<label class="input-group-text"><i class="fa fa-barcode" aria-hidden="true"></i>&nbsp;&nbsp;流水号</label>
							</div>
							<input style="width: auto" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" onafterpaste="this.value=this.value.replace(/[^\d]/g,'')" name="WIDout_trade_no" id="WIDout_trade_no" class="form-control" disabled/>
						</div>
					</li>
					<li class="list-group-item">
						<div class="input-group">
							<div class="input-group-prepend"><label class="input-group-text"><i class="fa fa-commenting-o" aria-hidden="true"></i>&nbsp;&nbsp;赞助留言</label></div>
							<input name="WIDsubject" id="WIDsubject" class="form-control" required="required"/></div>
					</li>
					<li class="list-group-item">
						<div class="input-group">
							<div class="input-group-prepend"><label class="input-group-text"><i class="fa fa-credit-card-alt" aria-hidden="true"></i>&nbsp;&nbsp;赞助金额</label></div>
							<input name="WIDtotal_fee" id="WIDtotal_fee" onkeyup="this.value=this.value.replace(/[^\d.]/g,'')" onafterpaste="this.value=this.value.replace(/[^\d.]/g,'')" class="form-control" required="required"/></div>
					</li>
				</ul>
				<div class="card-body text-center">
					<button type="radio" name="pay" id="pay" value="pay" class="btn btn-primary btn-block">点击赞助</button>
				</div>
			</div>
		</div>
		<div class="col-sm-12 col-md-6 bgt">
			<div class="card mb-3">
				<div class="card-header" style="background: linear-gradient(to right,#14b7ff,#5ccdde,#b221ff);">
					数据统计
				</div>
				<table>
					<tbody class="text-center">
					<tr>
						<td>
							<b>今日赞助次数</b></br><code>{{YaoFan_total()[0]}}</code></br>次
						</td>
						<td>
							<b>今日赞助金额</b></br><code>{{YaoFan_total()[1]}}</code></br>元
						</td>
					</tr>
					<tr>
						<td>
							<b>昨日赞助次数</b></br><code>{{YaoFan_total()[2]}}</code></br>次
						</td>
						<td>
							<b>昨日赞助金额</b></br><code>{{YaoFan_total()[3]}}</code></br>元
						</td>
					</tr>
					<tr height="50">
						<td align="center">
							<b>累计赞助次数</b></br><code>{{YaoFan_total()[4]}}</code></br>次
						</td>
						<td align="center">
							<b>累计赞助金额</b></br><code>{{YaoFan_total()[5]}}</code></br>元
						</td>
					<tbody>
				</table>
			</div>
			<div class="card">
				<div class="card-header" style="background: linear-gradient(to right,#b221ff,#14b7ff,#8ae68a);">
					大佬们的赞助记录
				</div>
				<table class="table table-borderless">
					<thead>
					<tr>
						<th scope="col">
							流水号
						</th>
						<th scope="col">
							赞助金额
						</th>
						<th scope="col">
							状态
						</th>
					</tr>
					</thead>
					<tbody>
					{%for jl in YaoFanJiLu()%}
					<tr>
						<td scope="row">
							{{jl.trade_id}}
						</td>
						<td>
							{{jl.money}}元
						</td>
						<td>
							{%if jl.trade_status==True%}
							<span color="green">完成赞助</span>
							{%else%}
							<span color="red">赞助取消</span>
							{%endif%}
						</td>
					</tr>
					{%endfor%}
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<footer class="col-sm-12 col-md-6 bgt" style="background-color: white;>
		&copy; <a href="https://52hentai.ml/">绅士世界赞助系统</a>
	</footer>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/layer/3.1.0/layer.js"></script>
<script type="text/javascript">
    //*******************提交按钮************************
    $("#pay").click(function () {
        var a = $('#kc').attr("alt");
        if (a <= 0) {
            layer.msg('该商品库存不足，无法购买！');
            return;
        }
        var money = $("#WIDtotal_fee").val();//获取商品价格<展示>
        var out_trade_no = $("#WIDout_trade_no").val();//订单编号 *
        var str = "老板，谢谢打赏<br>订单编号：" + out_trade_no +
            "<br>打赏金额：￥" + money;

        layer.confirm(str, {
            btn: ['我要打赏', '不打赏了'] //按钮
        }, function () {
            //异步创建订单
            var ii = layer.load(2, {shade: [0.1, '#fff']})
            $.ajax({
                type: "POST",
                url: "{{url_for('faka.CreateOrder')}}",
                data: {"out_trade_no": out_trade_no, "money": money},
                dataType: 'json',
                //timeout : 5000,
                success: function (data) {
                    layer.close(ii);
                    if (data.code != 0) {
                        layer.msg('服务器错误');
                        return false;
                    }
                    else {
                        str = "微信/支付宝扫码支付<br><img src='" + data.qr_pc + "'>";
                        // // pc显示二维码
                        // if (ispc){
                        //   str="微信/支付宝扫码支付<br><img src='"+data.qr_pc+"'>";
                        // }
                        // //手机显示付款方式
                        // else{
                        //   str="<a href='"+data.qr_mobile+"' target='_blank'>点击付款</a>";
                        // }
                        layer.confirm(str, {
                            btn: ['已打赏', '后悔了'] //按钮
                        }, function (index) {
                            window.location.reload();
                            layer.close(index);
                        });
                    }
                },
                error: function (data) {
                    layer.close(ii);
                    layer.msg('服务器错误');
                    return false;
                }
            })
            //*********************************************


        }, function () {
            layer.msg('老板行行好吧....我已经3天没吃饭了', {
                time: 5000, //20s后自动关闭
                btn: ['再考虑一下~']
            });
        });
    })

    //生成单号
    function d() {
        var d = new Date();
        var e;
        e = d.getFullYear() + "" + d.getMonth() + "" + d.getDate() + "" + d.getHours() + "" + d.getMinutes() + "" + d.getMilliseconds();
        return e;
    }

    //随机金额
    function m() {
        var moneys = [[0.66, '66大顺'], [0.88, '恭喜发财'], [1.1, '一生一世'], [2.33, '笑看人生'], [3.14, '数学之美'], [5.20, '爱你哟'], [6.66, '真的很6']];
        var value = moneys[Math.round(Math.random() * (moneys.length - 1))];
        $('#WIDsubject').val(value[1]);
        $('#WIDtotal_fee').val(value[0]);
    }

    $('#WIDout_trade_no').val(d());
    m();
</script>
</body>
</html>
